<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise-Chatbot - Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 0.95em;
            opacity: 0.95;
        }
        
        .content {
            padding: 30px;
        }
        
        .diagram-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            border: 2px solid #e9ecef;
            margin-bottom: 25px;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 500px;
        }
        
        .description {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .description h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .description p {
            color: #555;
            margin: 8px 0;
        }
        
        .layers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .layer-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .layer-card:hover {
            border-color: #667eea;
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.12);
            transform: translateY(-2px);
        }
        
        .layer-card h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1em;
        }
        
        .layer-card p {
            color: #666;
            font-size: 0.85em;
            line-height: 1.5;
        }
        
        .footer {
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            padding: 15px 30px;
            text-align: center;
            color: #888;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Enterprise-Chatbot Architecture</h1>
            <p>Sistema Conversazionale Orchestrato - High-Level Overview</p>
        </div>
        
        <div class="content">
            <div class="diagram-container">
                <div class="mermaid">
graph TD
    User["üë§ User"]
    
    UI["üé® Angular UI<br/>Presentation Layer"]
    
    ORCH["üîå FastAPI<br/>Orchestration Layer"]
    
    NLP["ü§ñ RASA<br/>Conversational Engine"]
    
    DECISION{"üîÄ Response Type?"}
    
    TEMPLATE["üìù Template Response"]
    ACTION["‚öôÔ∏è Custom Action"]
    
    KNOWLEDGE["üìö Knowledge Layer<br/>PostgreSQL | ChromaDB | Ollama"]
    
    RESPONSE["‚úÖ Response"]
    
    User -->|1. Send Message| UI
    UI -->|2. REST| ORCH
    ORCH -->|3. Process| NLP
    NLP -->|4. Decide| DECISION
    DECISION -->|5a. Simple| TEMPLATE
    DECISION -->|5b. Complex| ACTION
    ACTION -->|6. Access| KNOWLEDGE
    TEMPLATE -->|7. Generate| RESPONSE
    KNOWLEDGE -->|7. Generate| RESPONSE
    RESPONSE -->|8. Return Response| ORCH
    ORCH -->|9. Update State| UI
    UI -->|10. Display| User
                </div>
            </div>
            
            <div class="description">
                <h3>üìä Livelli Architetturali (Top-Down)</h3>
                <p>
                    <strong>1. Presentation Layer (Angular):</strong> Interfaccia utente. Raccoglie input conversazionali, gestisce sessioni di chat, visualizza risposte e controlli per profilo/accessibilit√†. Orchiesta le REST API verso il backend senza logica applicativa complessa.
                </p>
                <p>
                    <strong>2. Orchestration Layer (FastAPI):</strong> Fulcro architetturale. Riceve messaggi REST, gestisce autenticazione e validazione, coordina RASA, accede a PostgreSQL per salvataggio sessioni e contexto, mantiene sincronizzato lo stato.
                </p>
                <p>
                    <strong>3. Conversational Engine (RASA):</strong> Motore NLP principale. Elabora messaggi, riconosce intenti, identifica entit√†, gestisce slot e dialogo tramite policies. Decide se rispondere con template statico o delegare a Custom Action.
                </p>
                <p>
                    <strong>4. Response Strategy Decision:</strong> RASA determina il tipo di risposta. Intent semplici ‚Üí template. Intent complessi ‚Üí Custom Action (Python).
                </p>
                <p>
                    <strong>5. Custom Action Layer:</strong> Esecuzione logica avanzata. Accede a PostgreSQL per contesto utente/storico, consulta ChromaDB per ricerca semantica documenti aziendali, invoca Ollama per RAG pipeline (LLM generation con documenti come context).
                </p>
                <p>
                    <strong>6. Knowledge & Generation Layer:</strong> PostgreSQL (relational data), ChromaDB (vector embeddings + semantic search), Ollama (LLM local execution with Llama/Phi/Mistral). Insieme implementano RAG per risposte controllate e basate su documenti.
                </p>
                <p>
                    <strong>7-8. Response Flow:</strong> Risposta generata torna a FastAPI ‚Üí salvataggio su PostgreSQL ‚Üí invio a Angular ‚Üí visualizzazione utente.
                </p>
            </div>
            
            <div class="layers">
                <div class="layer-card">
                    <h4>Frontend</h4>
                    <p>Angular 19 Standalone. Input conversazionali, gestione sessioni, visualizzazione risposte, controlli profilo e accessibilit√†.</p>
                </div>
                
                <div class="layer-card">
                    <h4>Backend API</h4>
                    <p>FastAPI + Uvicorn. REST endpoints, autenticazione, validazione, salvataggio conversazioni, accesso PostgreSQL, coordinamento con RASA.</p>
                </div>
                
                <div class="layer-card">
                    <h4>NLP Engine</h4>
                    <p>RASA Open Source. Intent recognition, entity extraction, dialog policies, conversation tracking, orchestrazione Custom Actions.</p>
                </div>
                
                <div class="layer-card">
                    <h4>Custom Actions</h4>
                    <p>Python-based. Estensione programmatica di RASA. Accesso database, query ChromaDB, invocazione LLM, integrazione logiche avanzate.</p>
                </div>
                
                <div class="layer-card">
                    <h4>Vector Database</h4>
                    <p>ChromaDB. Indicizzazione documenti aziendali, storage embedding, ricerca semantica. Pipeline ingestion basata su LangChain.</p>
                </div>
                
                <div class="layer-card">
                    <h4>Language Models</h4>
                    <p>Ollama. Esecuzione locale modelli (Llama 3.2, Phi-3, Mistral). RAG pipeline per generazione basata su documenti.</p>
                </div>
                
                <div class="layer-card">
                    <h4>Data Storage</h4>
                    <p>PostgreSQL. Persistenza utenti, sessioni, messaggi conversazionali e metadati.</p>
                </div>
                
                <div class="layer-card">
                    <h4>Deployment</h4>
                    <p>Docker + docker-compose. Portabilit√†, isolamento, scalabilit√†. Ogni componente indipendente e sostituibile.</p>
                </div>
            </div>
            
            <div class="description">
                <h3>üîÑ Flusso Conversazione</h3>
                <p>
                    <strong>1.</strong> Utente invia messaggio tramite interfaccia Angular<br>
                    <strong>2.</strong> Frontend effettua REST call a FastAPI<br>
                    <strong>3.</strong> FastAPI elabora la richiesta e la invia a RASA<br>
                    <strong>4a.</strong> Se intent richiede Template Response ‚Üí RASA ritorna risposta predefinita<br>
                    <strong>4b.</strong> Se intent richiede logica complessa ‚Üí RASA delega a Custom Action<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;‚Üí Custom Action consulta ChromaDB per contesto semantico<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;‚Üí Custom Action invoca Ollama (LLM) per generazione testo<br>
                    <strong>5.</strong> Risposta generata torna a FastAPI<br>
                    <strong>6.</strong> FastAPI salva conversazione su PostgreSQL e ritorna a Frontend<br>
                    <strong>7.</strong> Frontend visualizza risposta nel chat
                </p>
            </div>
            
            <div class="description">
                <h3>‚ú® Caratteristiche Chiave</h3>
                <p>
                    <strong>Modularit√†:</strong> Componenti indipendenti, ognuno scalabile e sostituibile senza impatto su altri.<br>
                    <strong>Rigidit√† Controllata:</strong> Intent-based routing garantisce flussi operativi strutturati e prevedibili.<br>
                    <strong>Flessibilit√† Generativa:</strong> RAG pipeline + LLM locali permettono risposte contestuali e coerenti.<br>
                    <strong>Containerizzazione:</strong> Docker assicura portabilit√† e facilit√† di deployment.<br>
                    <strong>Enterprise-ready:</strong> Architettura pensata per contesti aziendali reali con controlli di accesso, autenticazione e audit trail.
                </p>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>Enterprise-Chatbot</strong> | Sistema Conversazionale Orchestrato | December 2025</p>
        </div>
    </div>
    
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
    </script>
</body>
</html>
